<ix-modal-header2
  [title]="'Widget Editor' | translate"
></ix-modal-header2>

  <ix-fieldset>
    <div class="form-row">
      <ix-select
        [formControl]="template"
        [options]="templateOptions$"
        [label]="'Template' | translate"
        [tooltip]="'Select a template' | translate"
      ></ix-select>

      <ix-icon-group
        [formControl]="layout"
        [options]="layoutsMap"
        [label]="'Layouts' | translate"
        [tooltip]="'Select a layout' | translate"
      ></ix-icon-group>
    </div>
  </ix-fieldset>

  <div class="editor-container">
    <ix-widget-editor-group
      [group]="group"
      [selectedSlot]="selectedSlot"
      (selectedSlotChange)="selectedSlotChanged($event)"
    ></ix-widget-editor-group>
  </div>

  <div class="widget-options-container">
    <ix-fieldset
      [title]="'Widget {slot} Settings' | translate: { slot: selectedSlot + 1 }"
    >
      <ix-select
        [formControl]="category"
        [options]="widgetCategoriesOptions$"
        [label]="'Widget Category' | translate"
      ></ix-select>

      <ix-select
        *ngIf="category.value"
        [formControl]="type"
        [options]="widgetTypesOptions$"
        [label]="'Widget Type' | translate"
      ></ix-select>

      <ng-container *ngIf="type.value">
        <ng-container
          *ngComponentOutlet="widgetRegistry[type.value].settingsComponent; inputs: { slotIndex: selectedSlot };"
        ></ng-container>
      </ng-container>
    </ix-fieldset>
  </div>
  <ix-form-actions class="form-actions">
    <button
      mat-button
      type="button"
      [ixTest]="['cancel-add-widget-group-btn']"
      (click)="chainedRef.close({ response: false, error: null })"
    >{{ 'Cancel' | translate }}</button>
    <button
      mat-button
      type="button"
      color="primary"
      [ixTest]="['add-widget-group-btn']"
      (click)="onSubmit()"
    >{{ 'Save' | translate }}</button>
  </ix-form-actions>

  <!-- TODO: Category dropdown, pull widget definitions from widgetRegistry and regroup by category -->
  <!-- TODO: Widget type dropdown -->
  <!-- TODO: Custom settings form if necessary for the selected widget type, like WidgetInterfaceIpSettingsComponent. -->
  <!-- TODO: This component shouldn't care what are the details of settings that are being set for every widget. -->
